{% load static %}
<!DOCTYPE html>
<html lang="en">
	<!-- BEGIN HEAD -->
	
	<head>
		{% comment %} <link rel="shortcut icon" href="{% static 'img/favicon.ico' %}" /> {% endcomment %}
	{% comment %} <meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1" name="viewport" />
	<meta name="description" content="Responsive Admin Template" />
	<meta name="author" content="SmartUniversity" />
	<title>{% block title %}Smart University | Bootstrap Responsive Admin Template{% endblock %}</title>
	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet" type="text/css" />
	<!-- icons -->
	<link href="{% static 'fonts/simple-line-icons/simple-line-icons.min.css' %}" rel="stylesheet" type="text/css" />
	<link href="{% static 'fonts/font-awesome/css/font-awesome.min.css' %}" rel="stylesheet" type="text/css" />
	<link href="{% static 'fonts/material-design-icons/material-icon.css' %}" rel="stylesheet" type="text/css" />
	<!--bootstrap -->
	<link href="{% static 'plugins/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" type="text/css" />
	<link href="{% static 'plugins/summernote/summernote.css' %}" rel="stylesheet">
	<!-- Material Design Lite CSS -->
	<link rel="stylesheet" href="{% static 'plugins/material/material.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/material_style.css' %}">
	<!-- inbox style -->
	<link href="{% static 'css/pages/inbox.min.css' %}" rel="stylesheet" type="text/css" />
	<!-- Theme Styles -->
	<link href="{% static 'css/theme/light/theme_style.css' %}" rel="stylesheet" id="rt_style_components" type="text/css" />
	<link href="{% static 'css/plugins.min.css' %}" rel="stylesheet" type="text/css" />
	<link href="{% static 'css/theme/light/style.css' %}" rel="stylesheet" type="text/css" />
	<link href="{% static 'css/responsive.css' %}" rel="stylesheet" type="text/css" />
	<link href="{% static 'css/theme/light/theme-color.css' %}" rel="stylesheet" type="text/css" />
	<!-- favicon --> {% endcomment %}

	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">

	<title>EstateAgency Bootstrap Template - Index</title>
	<meta content="" name="description">
	<meta content="" name="keywords">

	<!-- Favicons -->
	<link href="{% static 'img/favicon.png' %}" rel="icon">
	<link href="{% static 'img/apple-touch-icon.png' %}" rel="apple-touch-icon">

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">

	<!-- Vendor CSS Files -->
	<link href="{% static 'vendor/animate.css/animate.min.css' %}" rel="stylesheet">
	<link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
	<link href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
	<link href="{% static 'vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">

	<!-- Template Main CSS File -->
	<link href="{% static 'css/style.css' %}" rel="stylesheet">
	<!-- Template Jquery File -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
</head>
<!-- END HEAD -->
<body>
    {% block content %}
    {% endblock content %}

    {% include "customers/phone-number-modal.html" %}

	<div id="preloader"></div>
	<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
	<!-- Vendor JS Files -->
	<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
	<script src="{% static 'vendor/swiper/swiper-bundle.min.js' %}"></script>
	<script src="{% static 'vendor/php-email-form/validate.js' %}"></script>
	<!-- Template Main JS File -->
	<script src="{% static 'js/main.js' %}"></script>
	<script>
		function countryDropdown(seletor){
		  var Selected = $(seletor);
		  var Drop = $(seletor+'-drop');
		  var DropItem = Drop.find('li');
	  
		  Selected.click(function(){
			  Selected.toggleClass('open');
			  Drop.toggle();
		  });
	  
		  Drop.find('li').click(function(){
			  Selected.removeClass('open');
			  Drop.hide();
			  
			  var item = $(this);
			  Selected.html(item.html());
		  });
	  
		  DropItem.each(function(){
			  var code = $(this).attr('data-code');
	  
			  if(code != undefined){
				  var countryCode = code.toLowerCase();
				  $(this).find('i').addClass('flagstrap-'+countryCode);
			  }
		  });
	  }
	  countryDropdown('#country');
	  document.addEventListener("DOMContentLoaded", function(event) {
	  function OTPInput() {
	  const inputs = document.querySelectorAll('#otp > *[id]');
	  for (let i = 0; i < inputs.length; i++) { inputs[i].addEventListener('keydown', function(event) { if (event.key==="Backspace" ) { inputs[i].value='' ; if (i !==0) inputs[i - 1].focus(); } else { if (i===inputs.length - 1 && inputs[i].value !=='' ) { return true; } else if (event.keyCode> 47 && event.keyCode < 58) { inputs[i].value=event.key; if (i !==inputs.length - 1) inputs[i + 1].focus(); event.preventDefault(); } else if (event.keyCode> 64 && event.keyCode < 91) { inputs[i].value=String.fromCharCode(event.keyCode); if (i !==inputs.length - 1) inputs[i + 1].focus(); event.preventDefault(); } } }); } } OTPInput(); });
		</script>

    <script>
        $("#id_phone_number").keyup(function() {
            var phone_number = $("#id_phone_number").val()
            if(phone_number.length > 9){
                $("#id_send_otp").text("Send OTP")
                $("#id_error").addClass('d-none');
                // send_otp_with_backend()

            }
        });
        
        $("#id_send_otp").click(function(){
            var phone_number = $("#id_phone_number").val();
            if(phone_number.length > 9){
                var code = "+91"
                $.ajax({
                    method: "POST",
                    url: "{% url 'send_otp' %}",
                    headers: {"X-CSRFToken": "{{ csrf_token}}"},
                    data: {"phone_number": code+phone_number,},
                    success: function(response){
                        if(response.is_registerd === true && response.is_otp_verified === true) {
                            $('#id_first_step_modal_login').addClass("d-none");
                            $('#id_third_step_modal_login').removeClass("d-none");
                        }
						else if(response.is_registerd === false && response.is_otp_verified === true){
							window.location.href = "{% url 'user_register_profile' %}";
						}
                        else{
                            $('#id_first_step_modal_login').addClass("d-none");
                            var timeLeft = 30;
                            var elem = document.getElementById('id_otp_valid_time')
                            var timerId = setInterval(countdown, 1000);
                            function countdown() {
                                if (timeLeft == -1) {
                                    clearTimeout(timerId);
                                    elem.innerHTML = "Resend OTP";
                                    // $("#id_resend_otp").removeClass('d-none');
                                } else {
                                    elem.innerHTML = timeLeft + ' sec';
                                    timeLeft--;
                                }
                            }
                            $('#id_second_step_modal_login').removeClass("d-none");

                        }
                    },
                    error: function(error){
                        $("#id_error").removeClass('d-none');
                    }
                });
            }else{
                alert("Invalid Phone Number!!")
            }
        });

        $("#id_verify_otp").click(function() {
            var code = "+91"
            var phone_number = $("#id_phone_number").val();
            var first = $("#first").val();
            var second = $("#second").val();
            var third = $("#third").val();
            var fourth = $("#fourth").val();
            var fifth = $("#fifth").val();
            var sixth = $("#sixth").val();
            var otp = first + second + third + fourth + fifth + sixth;
            $.ajax({
                url: "{% url 'register' %}",
                method: "POST",
                headers: {"X-CSRFToken": "{{ csrf_token}}"},
                data: {'otp': otp,'phn':code+phone_number},
                success: function(data) {
                    if(data.message === "True"){
                        window.location.href = "{% url 'user_register_profile' %}";
                    }else{
                        $("#invalid_otp").removeClass('d-none');
                    }
                    

                },
                error: function(error) {
                    console.log(error);
                }
            });
        });


        
        $("#id_verify_password").click(function() {
            var phone_number = $("#id_phone_number").val();
            var password = $("#password").val();
            $.ajax({
                url: "{% url 'login_view' %}",
                method: "POST",
                headers: {"X-CSRFToken": "{{ csrf_token}}"},
                data: {'phone_number':phone_number,'password':password},
                success: function(data) {
                    console.log(data)
                },
                error: function(error){
                        $("#invalid_password").removeClass('d-none');
                    }
            });

        });
    </script>
    {% block js %}
    {% endblock js %}
</body>